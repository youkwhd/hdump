#! /usr/bin/factor-vm -roots=../

USING: hdump.args io io.encodings.utf8 io.files kernel math
math.parser prettyprint sequences ;
IN: hdump

: >hex! ( n -- str )
    >hex dup length 1 = [ "0" swap append ] when ;

: print-in-hex ( str -- )
    0 swap

    [ dup length 2 >= ]
    [ 2 cut swap [ >hex! write ] each " " write
      swap 1 + dup 8 = [ nl drop 0 ] when swap ] while

    [ >hex! write ] each nl drop ;

: main ( -- )
    get-in/out-files swap
    dup f = [ drop read-contents ] [ utf8 file-contents ] if
    print-in-hex
    drop ;

MAIN: main
